# Backend 리뷰 관점 가이드 & 출력 포맷

## 리뷰 관점 (10개)

각 관점에서 diff를 분석하고, 발견 사항을 아래 태그로 분류합니다.

### 1. API Design `[API]`

- RESTful 원칙 준수 (HTTP 메서드, 상태 코드, URL 패턴)
- API 버저닝 전략 일관성
- 요청/응답 스키마 설계 (일관된 필드명, 불필요한 데이터 노출)
- Breaking change 여부 (필드 삭제, 타입 변경, 필수값 추가)
- 페이지네이션, 필터링, 정렬 패턴
- API 문서 (OpenAPI/Swagger) 업데이트 여부

### 2. Security `[Security]`

- **인젝션**: SQL/NoSQL 인젝션, Command 인젝션
- **인증/인가**: 토큰 검증, 권한 체크 누락, 세션 관리
- **입력 검증**: 사용자 입력 sanitization, 타입/범위 검증
- **민감 정보**: API 키, 비밀번호, 토큰이 코드/로그에 노출
- **CORS**: 과도하게 열린 CORS 설정
- **의존성**: 알려진 취약점이 있는 패키지 사용

### 3. Database `[DB]`

- **쿼리 성능**: N+1 문제, 불필요한 조인, 인덱스 미사용
- **마이그레이션**: 스키마 변경의 하위 호환성, 롤백 가능성
- **트랜잭션**: 데이터 정합성을 위한 트랜잭션 범위
- **커넥션 관리**: 풀 사이즈, 커넥션 누수
- **ORM 사용**: lazy/eager loading 적절성, raw query 필요성
- **인덱스**: WHERE/JOIN/ORDER BY에 사용되는 컬럼의 인덱스 존재

### 4. Error Handling `[Error]`

- **에러 응답**: 일관된 에러 포맷, 적절한 HTTP 상태 코드
- **예외 처리**: catch-all 남용, 예외 무시(swallow), 구체적 예외 타입
- **복구 전략**: 재시도 로직, fallback, circuit breaker
- **에러 전파**: 내부 에러가 클라이언트에 노출되는지 (스택 트레이스 등)
- **유효성 검증 에러**: 명확한 에러 메시지, 필드별 에러 정보

### 5. Performance `[Perf]`

- **알고리즘**: O(n²) 이상의 복잡도, 불필요한 반복
- **캐싱**: 캐시 기회 누락, 캐시 무효화 전략
- **비동기 처리**: blocking I/O, 병렬화 가능한 작업
- **페이로드 크기**: 불필요한 데이터 전송, 압축
- **배치 처리**: 대량 데이터 처리 시 메모리/시간 효율
- **리소스 관리**: 파일 핸들, 커넥션, 메모리 누수

### 6. Concurrency `[Concurrency]`

- **Race condition**: 공유 자원 동시 접근
- **데드락**: 락 획득 순서 불일치
- **원자적 연산**: 트랜잭션 없는 다중 DB 수정
- **멱등성**: 중복 요청에 대한 안전한 처리
- **큐/워커**: 메시지 처리 순서, 실패 시 재처리

### 7. Logic `[Logic]`

- 비즈니스 로직 오류
- Edge case 미처리 (빈 배열, null, 0, 음수, 경계값)
- 조건문 논리 오류 (AND/OR 혼동)
- 상태 전이 오류
- 시간/타임존 처리

### 8. Configuration `[Config]`

- 하드코딩된 값 (매직 넘버, URL, 포트)
- 환경별 설정 분리 (dev/staging/prod)
- 환경변수 검증 (필수 값 누락 시 명확한 에러)
- 시크릿 관리 (평문 저장 방지)
- 기본값의 적절성

### 9. Observability `[Observability]`

- **로깅**: 적절한 로그 레벨, 구조화된 로그, 민감정보 마스킹
- **메트릭**: 주요 비즈니스/기술 메트릭 수집
- **트레이싱**: 분산 추적 지원
- **헬스체크**: readiness/liveness 프로브
- **디버그 로그**: 프로덕션 코드에 남은 console.log/print

### 10. Testing `[Testing]`

- 테스트 커버리지 부족 (특히 에러 경로, 엣지 케이스)
- 단위/통합/E2E 테스트 적절성
- 테스트 격리 (외부 의존성 모킹)
- 테스트 데이터 관리 (fixture, factory)
- CI 통합 여부

---

## 분류 기준

### "머지 전 확인 필요" (Must-fix)

다음 중 하나에 해당:
- 보안 취약점 (인젝션, 인증 우회, 민감정보 노출)
- 데이터 손실/정합성 문제
- 프로덕션 장애 유발 가능성 높은 버그
- Breaking API 변경 (하위 호환성 미고려)

### "개선 권장" (Nice-to-have)

다음 중 하나에 해당:
- 성능 개선 기회
- 코드 품질/가독성 향상
- 테스트 보강
- 관측 가능성(observability) 개선
- 리팩토링 제안

## 최종 판정 기준

| 판정 | 조건 |
|------|------|
| **APPROVED** | "머지 전 확인 필요" 항목 없음 |
| **APPROVED with suggestions** | "머지 전 확인 필요" 항목 없고, "개선 권장" 항목 있음 |
| **CHANGES REQUESTED** | "머지 전 확인 필요" 항목 1개 이상 |

---

## 출력 포맷

```markdown
## PR #{id} Backend Code Review: {title}

**Repo**: {workspace}/{repo}
**Branch**: {source} → {target}
**Author**: {author}
**Date**: {date}
**Domain**: Backend

---

### 변경 요약

{이 PR이 무엇을 하는지 2-3문장으로 요약}

---

### 머지 전 확인 필요

| # | 유형 | 파일 | 내용 |
|---|------|------|------|
| 1 | [Security] | `src/api/users.py:45` | 설명 |
| 2 | [DB] | `migrations/002_add_index.sql:12` | 설명 |

{각 항목에 대한 상세 설명과 수정 제안}

---

### 개선 권장

| # | 유형 | 파일 | 내용 |
|---|------|------|------|
| 1 | [Perf] | `src/services/report.py:88` | 설명 |
| 2 | [Testing] | 전체 | 설명 |

{각 항목에 대한 상세 설명과 수정 제안}

---

### 잘 된 부분

- {칭찬할 만한 구현 결정이나 코드 품질}
- {적절한 에러 처리나 보안 고려}

---

### 최종 판정

**APPROVED / APPROVED with suggestions / CHANGES REQUESTED**

{판정 이유 1-2문장}
```

---

## 리뷰 작성 원칙

1. **보안 최우선**: 인젝션, 인증 우회, 민감정보 노출은 최우선 검토합니다.
2. **데이터 정합성**: DB 트랜잭션, 동시성, 마이그레이션 안전성에 집중합니다.
3. **구체적으로**: 파일명과 라인 번호를 명시합니다.
4. **근거 제시**: 왜 문제인지, 어떤 상황에서 문제가 발생하는지 설명합니다.
5. **대안 제시**: 문제만 지적하지 말고, 어떻게 수정하면 좋을지 제안합니다.
6. **균형 유지**: 문제점뿐 아니라 잘 된 부분도 언급합니다.
